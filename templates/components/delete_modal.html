<!-- Delete Confirmation Modal Component -->
<div id="deleteModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-lg shadow-xl max-w-lg w-full p-6 transform transition-all">
        <!-- Warning Icon -->
        <div class="flex items-center justify-center mb-4">
            <div class="rounded-full bg-red-100 p-3">
                <svg class="h-10 w-10 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
            </div>
        </div>

        <!-- Title -->
        <h3 class="text-lg font-semibold text-gray-900 text-center mb-2">
            Confirmar Exclusão
        </h3>

        <!-- Message -->
        <p class="text-sm text-gray-600 text-center mb-4" id="deleteModalMessage">
            Tem certeza que deseja excluir este registro?
        </p>

        <!-- Item Details -->
        <div id="deleteModalDetails" class="bg-gray-50 rounded-lg p-4 mb-6 hidden">
            <!-- Will be populated dynamically -->
        </div>

        <!-- Warning for related items -->
        <div id="deleteModalWarning" class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-6 hidden">
            <div class="flex items-start">
                <svg class="h-5 w-5 text-yellow-400 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd"
                        d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                        clip-rule="evenodd" />
                </svg>
                <div>
                    <h4 class="text-sm font-medium text-yellow-800">Atenção</h4>
                    <p class="text-sm text-yellow-700 mt-1" id="deleteModalWarningText"></p>
                </div>
            </div>
        </div>

        <!-- Footer Note -->
        <p class="text-xs text-gray-500 text-center mb-6">
            Esta ação não pode ser desfeita. O registro será marcado como excluído.
        </p>

        <!-- Actions -->
        <div class="flex justify-end gap-3">
            <button type="button" onclick="closeDeleteModal()"
                class="px-4 py-2 bg-white border w-full border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all">
                Cancelar
            </button>
            <button type="button" id="confirmDeleteBtn"
                class="px-4 py-2 bg-red-600 text-white w-full rounded-lg hover:bg-red-700 transition-all">
                Sim, Excluir
            </button>
        </div>
    </div>
</div>

<script>
    let deleteUrl = null;
    let deleteRedirectUrl = null;

    function openDeleteModal(url, itemName, itemDetails = null, warning = null, redirectUrl = null) {
        deleteUrl = url;
        deleteRedirectUrl = redirectUrl;

        // Update message
        const message = `Tem certeza que deseja excluir ${itemName}?`;
        document.getElementById('deleteModalMessage').textContent = message;

        // Update details if provided
        const detailsElement = document.getElementById('deleteModalDetails');
        if (itemDetails) {
            detailsElement.innerHTML = itemDetails;
            detailsElement.classList.remove('hidden');
        } else {
            detailsElement.classList.add('hidden');
        }

        // Update warning if provided
        const warningElement = document.getElementById('deleteModalWarning');
        const warningText = document.getElementById('deleteModalWarningText');
        if (warning) {
            warningText.textContent = warning;
            warningElement.classList.remove('hidden');
        } else {
            warningElement.classList.add('hidden');
        }

        // Show modal
        document.getElementById('deleteModal').classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }

    function closeDeleteModal() {
        document.getElementById('deleteModal').classList.add('hidden');
        document.body.style.overflow = 'auto';
        deleteUrl = null;
        deleteRedirectUrl = null;
    }

    // Handle delete confirmation
    document.getElementById('confirmDeleteBtn').addEventListener('click', async function () {
        if (!deleteUrl) return;

        const btn = this;
        btn.disabled = true;
        btn.textContent = 'Excluindo...';

        try {
            const response = await fetch(deleteUrl, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                    'Content-Type': 'application/json',
                },
            });

            if (response.ok) {
                closeDeleteModal();

                // Show success message
                if (window.showToast) {
                    showToast('Registro excluído com sucesso!', 'success');
                }

                // Redirect or reload
                if (deleteRedirectUrl) {
                    window.location.href = deleteRedirectUrl;
                } else {
                    window.location.reload();
                }
            } else {
                throw new Error('Erro ao excluir');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Erro ao excluir o registro. Tente novamente.');
            btn.disabled = false;
            btn.textContent = 'Sim, Excluir';
        }
    });

    // Close modal on ESC key
    document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') {
            closeDeleteModal();
        }
    });

    // Close modal on backdrop click
    document.getElementById('deleteModal').addEventListener('click', function (e) {
        if (e.target === this) {
            closeDeleteModal();
        }
    });
</script>